- name: Install and configure an Active Directory domain controller
  hosts: domctls
  
  tasks:
    - name: Install ADDS role and management tools
      ansible.windows.win_feature:
        name: AD-Domain-Services
        state: present
        include_management_tools: true
    
    - name: Run post-installation config script
      ansible.windows.win_powershell:
        script: |
          Import-Module ADDSDeployment
          $domainParams = @{
            DomainName = 'example.com'
            DomainNetbiosName = 'EXAMPLE'
            ForestMode = 'Win2025'
            DomainMode = 'Win2025'
            CreateDnsDelegation = $false
            InstallDns = $true
            Force = $true
          }
          $DSRMpassword = ConvertTo-SecureString 'Ex@mpledotcom!!!123' -AsPlainText -Force
          Install-ADDSForest @domainParams -SafeModeAdministratorPassword $DSRMpassword

      
